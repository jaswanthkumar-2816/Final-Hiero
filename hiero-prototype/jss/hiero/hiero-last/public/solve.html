<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Orbit Studio | Neural Workspace</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap"
    rel="stylesheet">
  <style>
    :root {
      --orbit-green: #00ff66;
      --orbit-green-dim: rgba(0, 255, 102, 0.15);
      --orbit-green-glow: rgba(0, 255, 102, 0.4);
      --bg-obsidian: #030403;
      --bg-void: #000000;
      --panel-bg: rgba(13, 15, 13, 0.7);
      --border-glass: rgba(0, 255, 102, 0.1);
      --text-primary: #f1f5f9;
      --text-secondary: #94a3b8;
      --font-main: 'Outfit', sans-serif;
      --font-code: 'JetBrains Mono', monospace;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: var(--font-main);
      background: var(--bg-void);
      color: var(--text-primary);
      height: 100vh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    /* Animated Nebula Background */
    .nebula {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background:
        radial-gradient(circle at 10% 20%, rgba(0, 255, 102, 0.05) 0%, transparent 40%),
        radial-gradient(circle at 90% 80%, rgba(0, 255, 102, 0.03) 0%, transparent 40%);
      z-index: -1;
      filter: blur(100px);
      animation: nebulaFlow 20s infinite alternate linear;
    }

    @keyframes nebulaFlow {
      from {
        transform: scale(1) translate(0, 0);
      }

      to {
        transform: scale(1.2) translate(5%, 5%);
      }
    }

    /* Top Navigation */
    nav {
      height: 64px;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(20px);
      border-bottom: 1px solid var(--border-glass);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 24px;
      z-index: 100;
    }

    .nav-logo {
      display: flex;
      align-items: center;
      gap: 12px;
      cursor: pointer;
      transition: 0.3s;
    }

    .nav-logo:hover {
      opacity: 0.8;
    }

    .nav-logo img {
      height: 28px;
      filter: drop-shadow(0 0 8px var(--orbit-green));
    }

    .nav-logo span {
      font-weight: 800;
      letter-spacing: -0.5px;
      background: linear-gradient(135deg, #fff 0%, var(--orbit-green) 100%);
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .breadcrumb {
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 13px;
      font-weight: 500;
      color: var(--text-secondary);
    }

    .breadcrumb span.sep {
      opacity: 0.3;
    }

    .breadcrumb span.active {
      color: var(--orbit-green);
      font-weight: 700;
    }

    .action-btns {
      display: flex;
      gap: 12px;
    }

    .btn-minimal {
      background: transparent;
      border: 1px solid var(--border-glass);
      color: var(--text-secondary);
      padding: 6px 14px;
      border-radius: 8px;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: 0.2s;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .btn-minimal:hover {
      background: var(--orbit-green-dim);
      color: var(--orbit-green);
      border-color: var(--orbit-green);
    }

    /* Main Workspace Splitting */
    .workspace {
      flex: 1;
      display: grid;
      grid-template-columns: 420px 1fr 380px;
      overflow: hidden;
    }

    .panel {
      background: var(--panel-bg);
      backdrop-filter: blur(40px);
      display: flex;
      flex-direction: column;
      border-right: 1px solid var(--border-glass);
      overflow: hidden;
    }

    .panel-header {
      padding: 16px 24px;
      border-bottom: 1px solid var(--border-glass);
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: 11px;
      font-weight: 800;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: var(--text-secondary);
    }

    /* Problem Context Panel */
    .context-body {
      flex: 1;
      padding: 32px 24px;
      overflow-y: auto;
    }

    .difficulty {
      display: inline-block;
      font-size: 10px;
      font-weight: 800;
      padding: 4px 10px;
      border-radius: 99px;
      margin-bottom: 16px;
    }

    .difficulty.easy {
      background: rgba(0, 255, 102, 0.1);
      color: var(--orbit-green);
    }

    .difficulty.medium {
      background: rgba(255, 170, 0, 0.1);
      color: #ffaa00;
    }

    .difficulty.hard {
      background: rgba(255, 50, 50, 0.1);
      color: #ff3232;
    }

    .title-h1 {
      font-size: 24px;
      font-weight: 800;
      margin-bottom: 12px;
      letter-spacing: -0.5px;
    }

    .desc-p {
      font-size: 15px;
      color: var(--text-secondary);
      line-height: 1.7;
      margin-bottom: 24px;
    }

    .hint-toggle {
      margin-top: 20px;
      padding: 16px;
      background: rgba(255, 255, 255, 0.02);
      border: 1px dashed var(--border-glass);
      border-radius: 12px;
      cursor: pointer;
      transition: 0.3s;
    }

    .hint-toggle:hover {
      background: rgba(0, 255, 102, 0.05);
    }

    /* Code Editor Panel */
    .editor-container {
      position: relative;
      background: #000;
      display: flex;
      flex-direction: column;
    }

    .editor-toolbar {
      height: 44px;
      background: #080a08;
      border-bottom: 1px solid var(--border-glass);
      display: flex;
      align-items: center;
      padding: 0 20px;
      gap: 20px;
    }

    .toolbar-tab {
      font-size: 11px;
      font-weight: 700;
      color: var(--orbit-green);
      display: flex;
      align-items: center;
      gap: 6px;
    }

    #code-area {
      flex: 1;
      background: transparent;
      color: #d1d5db;
      font-family: var(--font-code);
      font-size: 15px;
      padding: 24px;
      border: none;
      outline: none;
      resize: none;
      line-height: 1.6;
    }

    /* Orbit Assistant Sidebar */
    .ai-panel {
      background: rgba(5, 7, 5, 0.8);
      border-left: 1px solid var(--border-glass);
    }

    .chat-stream {
      flex: 1;
      padding: 24px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .bubble {
      max-width: 90%;
      padding: 14px 18px;
      border-radius: 18px;
      font-size: 14px;
      line-height: 1.5;
    }

    .bubble.orbit {
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid var(--border-glass);
      color: var(--text-primary);
      align-self: flex-start;
      border-bottom-left-radius: 4px;
    }

    .bubble.you {
      background: var(--orbit-green);
      color: #000;
      font-weight: 600;
      align-self: flex-end;
      border-bottom-right-radius: 4px;
      box-shadow: 0 4px 12px var(--orbit-green-glow);
    }

    .chat-footer {
      padding: 20px;
      border-top: 1px solid var(--border-glass);
      background: rgba(0, 0, 0, 0.4);
    }

    .input-box {
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid var(--border-glass);
      border-radius: 12px;
      padding: 4px 4px 4px 14px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .input-box input {
      flex: 1;
      background: transparent;
      border: none;
      color: #fff;
      font-size: 14px;
      outline: none;
    }

    .send-pill {
      background: var(--orbit-green);
      color: #000;
      width: 32px;
      height: 32px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: 0.2s;
    }

    .send-pill:hover {
      transform: scale(1.05);
    }

    /* Workspace Footer Controls */
    .footer-shelf {
      height: 72px;
      background: rgba(0, 0, 0, 0.9);
      border-top: 1px solid var(--border-glass);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 32px;
    }

    .console-tab {
      display: flex;
      gap: 24px;
    }

    .c-tab {
      font-size: 12px;
      font-weight: 700;
      color: var(--text-secondary);
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: 0.2s;
    }

    .c-tab.active {
      color: var(--orbit-green);
    }

    .master-btns {
      display: flex;
      gap: 16px;
    }

    .btn-run {
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid var(--border-glass);
      color: var(--text-primary);
      padding: 10px 24px;
      border-radius: 10px;
      font-size: 14px;
      font-weight: 700;
      cursor: pointer;
      transition: 0.3s;
    }

    .btn-run:hover {
      background: rgba(255, 255, 255, 0.08);
    }

    .btn-submit {
      background: linear-gradient(135deg, var(--orbit-green) 0%, #00cc55 100%);
      border: none;
      color: #000;
      padding: 10px 32px;
      border-radius: 10px;
      font-size: 14px;
      font-weight: 800;
      cursor: pointer;
      box-shadow: 0 4px 15px var(--orbit-green-glow);
      transition: 0.3s;
    }

    .btn-submit:hover {
      transform: translateY(-2px);
      filter: brightness(1.1);
    }

    /* Console Drawer */
    .console-drawer {
      position: absolute;
      bottom: 72px;
      left: 420px;
      right: 380px;
      height: 0;
      background: #000;
      border-top: 2px solid var(--orbit-green);
      overflow: hidden;
      transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      z-index: 50;
    }

    .console-drawer.open {
      height: 260px;
    }

    .c-header {
      padding: 12px 24px;
      background: rgba(0, 255, 102, 0.05);
      font-size: 11px;
      font-weight: 800;
      display: flex;
      justify-content: space-between;
    }

    .c-body {
      padding: 20px 24px;
      font-family: var(--font-code);
      font-size: 13px;
      color: #00ff66;
      white-space: pre-wrap;
    }

    /* Success Master Overlay */
    #master-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.95);
      z-index: 2000;
      display: none;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: 0.5s;
    }

    .success-hero {
      text-align: center;
      transform: scale(0.9);
      transition: 0.5s;
    }

    .success-hero.pop {
      transform: scale(1);
    }

    .glow-ring {
      width: 120px;
      height: 120px;
      background: var(--orbit-green);
      border-radius: 50%;
      margin: 0 auto 32px auto;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 0 50px var(--orbit-green-glow);
      animation: ringPulse 2s infinite;
    }

    @keyframes ringPulse {
      0% {
        box-shadow: 0 0 30px var(--orbit-green-glow);
        transform: scale(1);
      }

      50% {
        box-shadow: 0 0 80px var(--orbit-green-glow);
        transform: scale(1.05);
      }

      100% {
        box-shadow: 0 0 30px var(--orbit-green-glow);
        transform: scale(1);
      }
    }

    .success-hero h2 {
      font-size: 48px;
      font-weight: 800;
      margin-bottom: 12px;
    }

    .success-hero p {
      color: var(--text-secondary);
      font-size: 18px;
      margin-bottom: 40px;
    }

    /* Responsive Fixes */
    @media (max-width: 1200px) {
      .workspace {
        grid-template-columns: 350px 1fr;
      }

      .ai-panel {
        display: none;
      }

      .console-drawer {
        right: 0;
      }
    }
  </style>
</head>

<body>
  <div class="nebula"></div>

  <nav>
    <div class="nav-logo" onclick="location.href='/'">
      <img src="logohiero copy.png" alt="Orbit">
      <span>ORBIT.STUDIO</span>
    </div>
    <div class="breadcrumb">
      <span>Algorithm Master</span>
      <span class="sep">/</span>
      <span id="b-skill" class="active">REACT</span>
    </div>
    <div class="action-btns">
      <button class="btn-minimal" onclick="location.href='learn.html' + window.location.search">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
          <path d="M19 12H5M12 19l-7-7 7-7" />
        </svg>
        EXIT WORKSPACE
      </button>
    </div>
  </nav>

  <div class="workspace">
    <aside class="panel">
      <div class="panel-header">
        <span>Problem Context</span>
        <span id="p-id">CH-072</span>
      </div>
      <div class="context-body">
        <div id="p-diff" class="difficulty medium">INTERMEDIATE</div>
        <h1 id="p-title" class="title-h1">Neural Stream Analysis</h1>
        <p id="p-desc" class="desc-p">
          Implement a synchronized data processing pipeline to stabilize the orbital signal stream. You need to ensure
          that the packet buffer remains within 10ms of the target latency.
        </p>

        <div class="hint-toggle" id="hint-box">
          <div style="font-size: 12px; font-weight: 800; color: var(--orbit-green); margin-bottom: 4px;">SYSTEM ADVISORY
          </div>
          <div style="font-size: 13px; color: var(--text-secondary);">Click to decrypt available hints from the Orbit
            database.</div>
        </div>
      </div>
    </aside>

    <main class="panel editor-container">
      <div class="editor-toolbar">
        <div class="toolbar-tab">
          <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor">
            <path
              d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zm4.24 16L12 15.45 7.77 18l1.12-4.81-3.73-3.23 4.92-.42L12 5l1.92 4.53 4.92.42-3.73 3.23L16.23 18z" />
          </svg>
          SOLUTIONS.JS
        </div>
      </div>
      <textarea id="code-area" spellcheck="false"></textarea>

      <div class="console-drawer" id="console">
        <div class="c-header">
          <span>VIRTUAL TERMINAL v1.4.0</span>
          <span style="color: var(--orbit-green)">STABLE CONNECTION</span>
        </div>
        <div class="c-body" id="console-out"></div>
      </div>
    </main>

    <aside class="panel ai-panel">
      <div class="panel-header">
        <span>Orbit Neural Assistant</span>
        <div
          style="width: 8px; height: 8px; background: var(--orbit-green); border-radius: 50%; box-shadow: 0 0 10px var(--orbit-green);">
        </div>
      </div>
      <div class="chat-stream" id="chat-msgs">
        <div class="bubble orbit">
          Hi, I'm Orbit. I've analyzed your current problem context. Need a hint on the synchronized implementation?
        </div>
      </div>
      <div class="chat-footer">
        <div class="input-box">
          <input type="text" id="chat-inp" placeholder="Ask Orbit for neural support...">
          <div class="send-pill" id="chat-send">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
              <path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z" />
            </svg>
          </div>
        </div>
      </div>
    </aside>
  </div>

  <footer class="footer-shelf">
    <div class="console-tab">
      <div class="c-tab active" id="toggle-console">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
          <path d="M4 17l6-6-6-6M12 19h8" />
        </svg>
        TERMINAL
      </div>
      <div class="c-tab">TEST CASES</div>
    </div>
    <div class="master-btns">
      <button class="btn-run" id="btn-run">RUN LOGIC</button>
      <button class="btn-submit" id="btn-submit">DEPLOY SOLUTION</button>
    </div>
  </footer>

  <div id="master-overlay">
    <div class="success-hero" id="hero-card">
      <div class="glow-ring">
        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#000" stroke-width="3.5">
          <polyline points="20 6 9 17 4 12"></polyline>
        </svg>
      </div>
      <h2>MISSION ACCOMPLISHED</h2>
      <p>Neural stream synchronized. Signal stability at 99.8%.</p>
      <button class="btn-submit" onclick="location.href='learn.html' + window.location.search"
        style="font-size: 16px; padding: 16px 48px;">RETURN TO STATION</button>
    </div>
  </div>

  <script>
    const editor = document.getElementById('code-area');
    const consoleDrawer = document.getElementById('console');
    const consoleOut = document.getElementById('console-out');
    const chatInp = document.getElementById('chat-inp');
    const chatMsgs = document.getElementById('chat-msgs');

    function initialize() {
      const params = new URLSearchParams(window.location.search);
      const skill = params.get('skill') || 'React';
      const title = params.get('title') || 'Neural Link Strategy';
      const desc = params.get('description') || 'Implement a synchronized data processing pipeline to stabilize the orbital signal stream.';
      const diff = params.get('difficulty') || 'intermediate';

      document.getElementById('p-title').innerText = title;
      document.getElementById('p-desc').innerText = desc;
      document.getElementById('p-diff').innerText = diff.toUpperCase();
      document.getElementById('p-diff').className = `difficulty ${diff.toLowerCase()}`;
      document.getElementById('b-skill').innerText = skill.toUpperCase();

      editor.value = "// Initialize Neural Stream\nfunction stabilizeSignal(packets) {\n    // Orbital logic here\n    console.log('Synchronizing signal...');\n    return true;\n}\n\nstabilizeSignal([]);";

      // Orbit Assistant Logic
      setupOrbit();
    }

    function setupOrbit() {
      const btn = document.getElementById('chat-send');
      const sendMessage = async () => {
        const text = chatInp.value.trim();
        if (!text) return;

        appendBubble('you', text);
        chatInp.value = '';

        const orbitBubble = appendBubble('orbit', 'Thinking...');

        try {
          const res = await fetch('/api/analysis/ask', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              question: text,
              skill: document.getElementById('b-skill').innerText,
              context: `Workspace: ${document.getElementById('p-title').innerText}`
            })
          });
          const data = await res.json();
          orbitBubble.innerText = '';
          await typeWriter(orbitBubble, data.answer);
        } catch (e) {
          orbitBubble.innerText = "System error. Neuro-link disrupted.";
        }
      };

      btn.onclick = sendMessage;
      chatInp.onkeypress = (e) => { if (e.key === 'Enter') sendMessage(); };
    }

    function appendBubble(role, text) {
      const div = document.createElement('div');
      div.className = `bubble ${role}`;
      div.innerText = text;
      chatMsgs.appendChild(div);
      chatMsgs.scrollTop = chatMsgs.scrollHeight;
      return div;
    }

    function typeWriter(el, text) {
      return new Promise(r => {
        let i = 0;
        const int = setInterval(() => {
          if (i < text.length) {
            el.innerText += text[i++];
            chatMsgs.scrollTop = chatMsgs.scrollHeight;
          } else {
            clearInterval(int);
            r();
          }
        }, 10);
      });
    }

    document.getElementById('toggle-console').onclick = () => {
      consoleDrawer.classList.toggle('open');
    };

    document.getElementById('btn-run').onclick = () => {
      consoleDrawer.classList.add('open');
      consoleOut.innerText = "> Initializing Neural Environment...\n> Running logic checks...\n> Processing Signal Stream [0...99]\n> Result: VIRTUAL STABILITY SECURED.\n\nReady for deployment.";
    };

    document.getElementById('btn-submit').onclick = () => {
      consoleDrawer.classList.add('open');
      consoleOut.innerText = "> DEPLOYING TO ORBITAL STATION...\n> Validating against 128 production streams...\n> 100% Match.\n\nMission Successful.";

      setTimeout(() => {
        const overlay = document.getElementById('master-overlay');
        const hero = document.getElementById('hero-card');
        overlay.style.display = 'flex';
        setTimeout(() => {
          overlay.style.opacity = '1';
          hero.classList.add('pop');
        }, 50);
      }, 1200);
    };

    initialize();
  </script>
</body>

</html>