<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Resume Analysis Result</title>
  <script src="learn-redirect.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;700&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --soft-teal: #030e04;
      --lavender: #011104;
      --warm-beige: #09c006;
      --soft-green: #08c108;
      --gold-accent: #169f04;
      --bg-light: #060706;
      --card-bg: rgb(3, 3, 3);
      --text-dark: #333333;
      --shadow-glow: 0 0 15px rgb(17, 173, 17), 0 0 10px rgba(212, 160, 23, 0.3);
      --border-radius: 15px;
      --padding: 20px;
    }
    body {
      margin: 0;
      padding: 0;
      background: linear-gradient(135deg, var(--soft-teal) 0%, var(--lavender) 50%, var(--warm-beige) 100%);
      font-family: 'Open Sans', sans-serif;
      color: var(--text-dark);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      overflow-x: hidden;
      position: relative;
      animation: gradientFlow 20s ease infinite;
    }
    @keyframes gradientFlow {
      0% { background-position: 0% 0%; }
      50% { background-position: 50% 50%; }
      100% { background-position: 0% 0%; }
    }
    .hero {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 100%;
      padding: 60px 30px;
      min-height: 100vh;
      position: relative;
      z-index: 1;
    }
    .logo-fixed {
      position: absolute;
      top: 25px;
      right: 32px;
      display: flex;
      align-items: center;
      z-index: 100;
      background: rgba(8, 164, 8, 0.805);
      border-radius: 12px;
      padding: 6px 16px 6px 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.959), var(--shadow-glow);
    }
    .logo-fixed img {
      height: 38px;
      width: 38px;
      min-width: 38px;
      min-height: 38px;
      object-fit: contain;
      filter: drop-shadow(var(--shadow-glow));
    }
    .logo-fixed span {
      font-weight: 700;
      letter-spacing: 1.5px;
      font-size: 1.2rem;
      margin-left: 6px;
      color: white;
    }
    h2 {
      font-family: 'Lora', serif;
      font-size: 2.2rem;
      color: var(--gold-accent);
      margin-bottom: 30px;
      animation: slideUp 2s ease-out;
    }
    @keyframes slideUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .main-flex {
      display: flex;
      gap: 32px;
      max-width: 1000px;
      width: 100%;
      margin: 0 auto;
      justify-content: center;
      align-items: flex-start;
      flex-wrap: wrap;
    }
    .left-col, .right-col {
      display: flex;
      flex-direction: column;
      gap: 30px;
      flex: 1 1 340px;
      min-width: 320px;
      max-width: 480px;
    }
    .card {
      background: var(--card-bg);
      border-radius: var(--border-radius);
      border: 1px solid rgba(241, 246, 241, 0.955);
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1), var(--shadow-glow);
      padding: var(--padding);
      display: flex;
      flex-direction: column;
      gap: 15px;
      min-height: 200px; /* Consistent card height */
      animation: liftUp 2.5s ease-out infinite;
    }
    @keyframes liftUp {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-5px); }
    }
    .score-section {
      align-items: center;
      text-align: center;
    }
    .score-ring {
      position: relative;
      width: 120px;
      height: 120px;
      margin: 0 auto;
    }
    .score-ring svg {
      position: absolute;
      top: 0;
      left: 0;
      transform: rotate(-90deg);
    }
    .score-ring .score-text {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 2.5rem;
      font-weight: 700;
      color: var(--soft-green);
      text-shadow: var(--shadow-glow);
      animation: gentlePulse 2s ease-in-out infinite;
    }
    @keyframes gentlePulse {
      0%, 100% { transform: translate(-50%, -50%) scale(1); }
      50% { transform: translate(-50%, -50%) scale(1.02); }
    }
    .score-label {
      color: var(--gold-accent);
      font-size: 1.2rem;
      margin-top: 10px;
    }
    .section-title {
      color: var(--soft-green);
      font-size: 1.5rem;
      font-weight: 600;
      margin-bottom: 15px;
    }
    .skills-list, .projects-list {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      margin: 0;
      padding: 0;
      list-style: none;
    }
    .skill-chip, .project-card {
      background: rgba(23, 209, 6, 0.8);
      border-radius: var(--border-radius);
      color: var(--text-dark);
      font-size: 1.1rem;
      padding: 10px 20px;
      border: 1px solid var(--soft-green);
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05), var(--shadow-glow);
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .skill-chip:hover, .project-card:hover {
      background: var(--soft-green);
      color: var(--bg-light);
      box-shadow: 0 4px 20px rgba(3, 215, 3, 0.6);
      transform: translateY(-2px);
    }
    .mock-interview-section {
      text-align: center;
      padding: 20px;
    }
    .interview-illustration {
      width: 90px;
      height: 90px;
      margin: 0 auto 12px;
      display: block;
    }
    .interview-illustration svg {
      width: 100%;
      height: 100%;
      filter: drop-shadow(0 2px 6px rgba(8, 193, 8, 0.2));
    }
    .mock-interview-section .section-title {
      margin-bottom: 8px;
      font-size: 1.4rem;
    }
    .mock-interview-section p {
      font-size: 0.9rem;
      margin-bottom: 15px;
      line-height: 1.5;
    }
    
    /* Mock Interview Modal */
    .interview-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.85);
      z-index: 1000;
      overflow-y: auto;
      animation: fadeIn 0.3s ease;
    }
    .interview-modal.active {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    .interview-container {
      background: var(--card-bg);
      border-radius: var(--border-radius);
      padding: 40px;
      max-width: 800px;
      width: 100%;
      box-shadow: 0 10px 50px rgba(8, 193, 8, 0.3);
      animation: slideIn 0.4s ease;
      position: relative;
    }
    @keyframes slideIn {
      from { transform: translateY(-50px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    .close-interview {
      position: absolute;
      top: 20px;
      right: 20px;
      background: transparent;
      border: none;
      font-size: 2rem;
      color: var(--gold-accent);
      cursor: pointer;
      transition: transform 0.3s ease;
    }
    .close-interview:hover {
      transform: rotate(90deg);
      color: #ff6b6b;
    }
    .interview-header {
      text-align: center;
      margin-bottom: 30px;
    }
    .interview-header h3 {
      font-family: 'Lora', serif;
      font-size: 2rem;
      color: var(--gold-accent);
      margin-bottom: 10px;
    }
    .interview-header p {
      color: var(--warm-beige);
      font-size: 1.1rem;
    }
    .question-container {
      background: rgba(8, 193, 8, 0.05);
      border-left: 4px solid var(--soft-green);
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 25px;
    }
    .question-number {
      color: var(--gold-accent);
      font-weight: 600;
      margin-bottom: 10px;
      font-size: 0.9rem;
    }
    .question-text {
      color: var(--warm-beige);
      font-size: 1.2rem;
      line-height: 1.6;
      margin-bottom: 20px;
    }
    .answer-input {
      width: 100%;
      min-height: 120px;
      padding: 15px;
      border: 2px solid rgba(8, 193, 8, 0.3);
      border-radius: 8px;
      background: rgba(0, 0, 0, 0.3);
      color: white;
      font-family: 'Open Sans', sans-serif;
      font-size: 1rem;
      resize: vertical;
      transition: border-color 0.3s ease;
    }
    .answer-input:focus {
      outline: none;
      border-color: var(--soft-green);
      box-shadow: 0 0 10px rgba(8, 193, 8, 0.2);
    }
    .answer-input::placeholder {
      color: rgba(255, 255, 255, 0.5);
    }
    .interview-controls {
      display: flex;
      gap: 15px;
      justify-content: center;
      margin-top: 30px;
      flex-wrap: wrap;
    }
    .interview-btn {
      background: var(--soft-green);
      color: white;
      border: none;
      border-radius: var(--border-radius);
      padding: 12px 30px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 2px 10px rgba(8, 193, 8, 0.3);
    }
    .interview-btn:hover {
      background: var(--gold-accent);
      transform: translateY(-2px);
      box-shadow: 0 4px 20px rgba(212, 160, 23, 0.5);
    }
    .interview-btn:disabled {
      background: #555;
      cursor: not-allowed;
      opacity: 0.5;
    }
    .interview-btn.secondary {
      background: transparent;
      border: 2px solid var(--soft-green);
      color: var(--soft-green);
    }
    .interview-btn.secondary:hover {
      background: var(--soft-green);
      color: white;
    }
    .progress-bar {
      width: 100%;
      height: 6px;
      background: rgba(8, 193, 8, 0.2);
      border-radius: 3px;
      margin-bottom: 20px;
      overflow: hidden;
    }
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--soft-green), var(--gold-accent));
      transition: width 0.3s ease;
      box-shadow: 0 0 10px rgba(8, 193, 8, 0.5);
    }
    .interview-complete {
      text-align: center;
      padding: 40px 20px;
    }
    .interview-complete h3 {
      font-family: 'Lora', serif;
      font-size: 2.2rem;
      color: var(--gold-accent);
      margin-bottom: 20px;
    }
    .interview-complete p {
      color: var(--warm-beige);
      font-size: 1.1rem;
      margin-bottom: 30px;
      line-height: 1.6;
    }
    .score-summary {
      background: rgba(8, 193, 8, 0.1);
      border-radius: 12px;
      padding: 20px;
      margin: 20px 0;
    }
    .score-summary h4 {
      color: var(--soft-green);
      margin-bottom: 15px;
    }
    .feedback-item {
      background: rgba(0, 0, 0, 0.3);
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 10px;
      border-left: 3px solid var(--gold-accent);
    }
    .feedback-item strong {
      color: var(--gold-accent);
      display: block;
      margin-bottom: 5px;
    }
    .feedback-item p {
      color: var(--warm-beige);
      font-size: 0.95rem;
      margin: 0;
    }
    
    .learn-first {
      margin-top: 20px;
      padding: 15px;
      background: linear-gradient(135deg, var(--soft-green), var(--gold-accent));
      color: white;
      border-radius: var(--border-radius);
      text-align: center;
    }
    .learn-first strong {
      display: block;
      margin-bottom: 10px;
      font-size: 1.1rem;
    }
    #start-learning-btn {
      margin-top: 10px;
      background: white;
      color: var(--soft-green);
      font-weight: bold;
      border: none;
      border-radius: var(--border-radius);
      padding: 12px 25px;
      font-size: 1.1rem;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1), var(--shadow-glow);
      cursor: pointer;
      transition: all 0.3s ease;
    }
    #start-learning-btn:hover {
      background: var(--bg-light);
      color: var(--gold-accent);
    }
    .timestamp {
      font-size: 1rem;
      color: var(--gold-accent);
      text-align: center;
      margin-top: 20px;
    }
    .button-row {
      display: flex;
      gap: 20px;
      margin-top: 30px;
      flex-wrap: wrap;
      justify-content: center;
    }
    .btn {
      background: var(--soft-green);
      color: var(--bg-light);
      border: none;
      border-radius: var(--border-radius);
      padding: 12px 25px;
      font-size: 1.1rem;
      font-weight: 600;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1), var(--shadow-glow);
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .btn:hover {
      background: var(--gold-accent);
      color: var(--bg-light);
      box-shadow: 0 4px 20px rgba(212, 160, 23, 0.6);
      transform: translateY(-2px);
    }
    .error-message {
      position: fixed;
      top: 20px;
      right: 20px;
      background: #dc3545;
      color: white;
      padding: 15px;
      border-radius: 8px;
      z-index: 1000;
      box-shadow: var(--shadow-glow);
      display: flex;
      gap: 10px;
      align-items: center;
    }
    .error-message button {
      background: transparent;
      border: none;
      color: white;
      cursor: pointer;
    }
    @media (max-width: 900px) {
      .main-flex {
        flex-direction: column;
        gap: 24px;
        align-items: stretch;
      }
      .left-col, .right-col {
        max-width: 98vw;
        margin: 0 auto;
      }
    }
    @media (max-width: 600px) {
      .logo-fixed {
        top: 50px;
        right: 10px;
        padding: 4px 10px 4px 4px;
      }
      .logo-fixed img {
        height: 24px !important;
        width: 24px !important;
        min-width: 24px !important;
        min-height: 24px !important;
      }
      .logo-fixed span {
        font-size: 0.9rem !important;
      }
      .card {
        min-height: 150px;
      }
      .language-btn {
        font-size: 0.9rem;
        padding: 8px 16px;
      }
      .interview-illustration {
        width: 75px;
        height: 75px;
        margin: 0 auto 10px;
      }
      .mock-interview-section .section-title {
        font-size: 1.25rem;
      }
      .mock-interview-section p {
        font-size: 0.85rem;
        margin-bottom: 12px;
      }
      .interview-container {
        padding: 25px;
      }
      .interview-header h3 {
        font-size: 1.6rem;
      }
      .question-text {
        font-size: 1.05rem;
      }
      .interview-controls {
        flex-direction: column;
      }
      .interview-btn {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="logo-fixed">
    <img src="logohiero copy.png" alt="Hiero Logo" style="height: 38px; width: 38px; min-width: 38px; min-height: 38px; object-fit: contain; filter: drop-shadow(var(--shadow-glow));">
    <span style="font-weight: 700; letter-spacing: 1.5px; font-size: 1.2rem; margin-left: 6px;">HIERO</span>
  </div>
  <div class="hero">
    <h2>Your Resume Analysis Results</h2>
    <div class="main-flex">
      <!-- Left Side: Score & Skills -->
      <div class="left-col">
        <div class="card">
          <section class="score-section" aria-labelledby="score-title">
            <h3 class="section-title" id="score-title">Overall Match Score</h3>
            <div class="score-ring">
              <svg width="120" height="120" role="img" aria-label="Resume match score">
                <circle class="bg" cx="60" cy="60" r="50" stroke="#e0e0e0" stroke-width="10" fill="none"/>
                <circle class="progress" cx="60" cy="60" r="50" stroke="var(--score-color, var(--soft-green))" stroke-width="10" fill="none" stroke-linecap="round"/>
              </svg>
              <div class="score-text" id="score-percent">0%</div>
            </div>
            <div class="score-label">Resume-Job Match Score</div>
          </section>
        </div>
        <div class="card">
          <section aria-labelledby="skills-title">
            <h3 class="section-title" id="skills-title">Missing Skills</h3>
            <ul class="skills-list" id="missing-skills-list"></ul>
            <div class="learn-first">
              <strong>Priority Skill to Learn:</strong> <span id="learn-first"></span>
              <button class="btn" id="start-learning-btn" aria-label="Start personalized learning">üöÄ Begin Learning Path</button>
            </div>
          </section>
        </div>
      </div>
      <!-- Right Side: Projects & Mock Interview -->
      <div class="right-col">
        <div class="card">
          <section aria-labelledby="projects-title">
            <h3 class="section-title" id="projects-title">Recommended Projects</h3>
            <ul class="projects-list" id="project-list"></ul>
          </section>
        </div>
        <div class="card">
          <section class="mock-interview-section" aria-labelledby="interview-title">
            <h3 class="section-title" id="interview-title">Mock Interview Preparation</h3>
            
            <!-- Interview Illustration -->
            <div class="interview-illustration">
              <svg viewBox="0 0 400 400" xmlns="http://www.w3.org/2000/svg">
                <!-- Background circle -->
                <circle cx="200" cy="200" r="190" fill="rgba(8, 193, 8, 0.08)" />
                
                <!-- Interviewer (left side) -->
                <g id="interviewer">
                  <!-- Head -->
                  <circle cx="130" cy="160" r="28" fill="#08c108" opacity="0.9"/>
                  <!-- Hair -->
                  <path d="M 103 152 Q 103 128 130 128 Q 157 128 157 152" fill="#2c3e50"/>
                  <!-- Body -->
                  <rect x="105" y="188" width="50" height="65" rx="8" fill="#08c108" opacity="0.85"/>
                  <!-- Arms -->
                  <rect x="90" y="200" width="12" height="40" rx="6" fill="#08c108" opacity="0.8"/>
                  <rect x="158" y="200" width="12" height="40" rx="6" fill="#08c108" opacity="0.8"/>
                  <!-- Laptop -->
                  <rect x="112" y="238" width="40" height="28" rx="4" fill="#2c3e50"/>
                  <rect x="116" y="242" width="32" height="20" rx="2" fill="#169f04"/>
                  <circle cx="132" cy="252" r="1.5" fill="#fff"/>
                </g>
                
                <!-- Candidate (right side) -->
                <g id="candidate">
                  <!-- Head -->
                  <circle cx="270" cy="175" r="32" fill="#169f04" opacity="0.9"/>
                  <!-- Hair -->
                  <ellipse cx="270" cy="157" rx="28" ry="20" fill="#2c3e50"/>
                  <!-- Body -->
                  <rect x="240" y="207" width="60" height="75" rx="8" fill="#169f04" opacity="0.85"/>
                  <!-- Arms -->
                  <rect x="220" y="222" width="16" height="45" rx="7" fill="#169f04" opacity="0.8"/>
                  <rect x="304" y="222" width="16" height="45" rx="7" fill="#169f04" opacity="0.8"/>
                  <!-- Smile -->
                  <path d="M 257 183 Q 270 191 283 183" stroke="#fff" stroke-width="2.5" fill="none" stroke-linecap="round"/>
                </g>
                
                <!-- Speech bubble (smaller and repositioned) -->
                <g id="speech-bubble">
                  <path d="M 190 105 L 310 105 L 310 140 L 250 140 L 235 152 L 242 140 L 190 140 Z" 
                        fill="#fff" stroke="#08c108" stroke-width="2" opacity="0.95"/>
                  <!-- Speech lines (smaller) -->
                  <line x1="205" y1="115" x2="295" y2="115" stroke="#08c108" stroke-width="2.5" stroke-linecap="round"/>
                  <line x1="205" y1="123" x2="275" y2="123" stroke="#08c108" stroke-width="2.5" stroke-linecap="round"/>
                  <line x1="205" y1="131" x2="255" y2="131" stroke="#08c108" stroke-width="2.5" stroke-linecap="round"/>
                </g>
                
                <!-- Decorative sparkles (smaller) -->
                <circle cx="340" cy="120" r="6" fill="#ffd700" opacity="0.7">
                  <animate attributeName="opacity" values="0.7;1;0.7" dur="2s" repeatCount="indefinite"/>
                </circle>
                <circle cx="70" cy="270" r="5" fill="#ffd700" opacity="0.7">
                  <animate attributeName="opacity" values="0.7;1;0.7" dur="2.5s" repeatCount="indefinite"/>
                </circle>
                <circle cx="350" cy="260" r="7" fill="#08c108" opacity="0.5">
                  <animate attributeName="opacity" values="0.5;0.8;0.5" dur="3s" repeatCount="indefinite"/>
                </circle>
              </svg>
            </div>
            
            <p style="color: var(--gold-accent); text-align: center; margin-bottom: 15px; line-height: 1.5; font-size: 0.9rem;">
              Get ready for your interviews with practice sessions. We'll ask questions based on your job description.
            </p>
            <button class="btn" id="start-interview-btn" style="width: 100%; font-size: 1rem; padding: 11px 18px;" aria-label="Start mock interview">
              üéØ Start Interview Practice
            </button>
          </section>
        </div>
      </div>
    </div>
    <div class="timestamp">
      Analysis completed on: <span id="timestamp"></span>
    </div>
    <div class="button-row">
      <button class="btn" onclick="window.location.href='/dashboard/analysis.html'" aria-label="Analyze another resume">üîÅ Analyze New Resume</button>
      <button class="btn" onclick="exportAnalysis()" aria-label="Export analysis">üìÑ Download Report</button>
    </div>
  </div>

  <!-- Mock Interview Modal -->
  <div id="interview-modal" class="interview-modal">
    <div class="interview-container">
      <button class="close-interview" onclick="closeInterview()" aria-label="Close interview">&times;</button>
      
      <div id="interview-content">
        <div class="interview-header">
          <h3>üéØ Mock Interview Practice</h3>
          <p>Practice your interview skills with AI-generated questions</p>
        </div>
        
        <div class="progress-bar">
          <div id="progress-fill" class="progress-fill" style="width: 0%"></div>
        </div>
        
        <div id="question-section">
          <div class="question-container">
            <div class="question-number" id="question-number">Question 1 of 5</div>
            <div class="question-text" id="question-text"></div>
            <textarea 
              id="answer-input" 
              class="answer-input" 
              placeholder="Type your answer here..."
              rows="5"
            ></textarea>
          </div>
          
          <div class="interview-controls">
            <button class="interview-btn secondary" id="prev-btn" onclick="previousQuestion()" disabled>
              ‚Üê Previous
            </button>
            <button class="interview-btn" id="next-btn" onclick="nextQuestion()">
              Next ‚Üí
            </button>
            <button class="interview-btn" id="submit-btn" onclick="submitInterview()" style="display: none;">
              Submit Interview
            </button>
          </div>
        </div>
        
        <div id="completion-section" style="display: none;">
          <div class="interview-complete">
            <h3>üéâ Interview Complete!</h3>
            <p>Great job! You've completed the mock interview. Here's your feedback:</p>
            
            <div class="score-summary">
              <h4>üìä Your Performance</h4>
              <div id="feedback-content"></div>
            </div>
            
            <div class="interview-controls">
              <button class="interview-btn" onclick="restartInterview()">
                üîÑ Try Again
              </button>
              <button class="interview-btn secondary" onclick="closeInterview()">
                Close
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const defaultData = {
      score: 85,
      missingSkills: ['Deep Learning', 'Data Visualization', 'Cloud Deployment'],
      skillToLearnFirst: 'Deep Learning',
      projectSuggestions: ['Build a Sentiment Analysis App', 'Deploy a ML Model to Cloud']
    };

    function sanitize(str) {
      const div = document.createElement('div');
      div.textContent = str;
      return div.innerHTML;
    }

    function validateData(data) {
      return data && typeof data.score === "number";
    }

    // Mock Interview System
    const interviewQuestions = [
      {
        question: "Tell me about yourself and your professional background.",
        category: "Introduction"
      },
      {
        question: "What are your key strengths and how do they align with this role?",
        category: "Skills"
      },
      {
        question: "Describe a challenging project you worked on and how you overcame obstacles.",
        category: "Experience"
      },
      {
        question: "Where do you see yourself in 5 years? What are your career goals?",
        category: "Goals"
      },
      {
        question: "Why are you interested in this position and our company?",
        category: "Motivation"
      }
    ];

    let currentQuestionIndex = 0;
    let interviewAnswers = [];

    function setupMockInterview() {
      const mockInterviewBtn = document.getElementById('mock-interview-btn');
      if (mockInterviewBtn) {
        mockInterviewBtn.addEventListener('click', () => {
          window.location.href = 'mock-interview.html';
        });
      }
    }

    function startInterview() {
      const modal = document.getElementById('interview-modal');
      modal.classList.add('active');
      currentQuestionIndex = 0;
      interviewAnswers = new Array(interviewQuestions.length).fill('');
      displayQuestion();
      document.body.style.overflow = 'hidden';
    }

    function closeInterview() {
      const modal = document.getElementById('interview-modal');
      modal.classList.remove('active');
      document.body.style.overflow = 'auto';
    }

    function displayQuestion() {
      const question = interviewQuestions[currentQuestionIndex];
      document.getElementById('question-number').textContent = 
        `Question ${currentQuestionIndex + 1} of ${interviewQuestions.length}`;
      document.getElementById('question-text').textContent = question.question;
      document.getElementById('answer-input').value = interviewAnswers[currentQuestionIndex] || '';
      
      // Update progress bar
      const progress = ((currentQuestionIndex) / interviewQuestions.length) * 100;
      document.getElementById('progress-fill').style.width = `${progress}%`;
      
      // Update button states
      document.getElementById('prev-btn').disabled = currentQuestionIndex === 0;
      
      const isLastQuestion = currentQuestionIndex === interviewQuestions.length - 1;
      document.getElementById('next-btn').style.display = isLastQuestion ? 'none' : 'inline-block';
      document.getElementById('submit-btn').style.display = isLastQuestion ? 'inline-block' : 'none';
    }

    function nextQuestion() {
      saveCurrentAnswer();
      if (currentQuestionIndex < interviewQuestions.length - 1) {
        currentQuestionIndex++;
        displayQuestion();
      }
    }

    function previousQuestion() {
      saveCurrentAnswer();
      if (currentQuestionIndex > 0) {
        currentQuestionIndex--;
        displayQuestion();
      }
    }

    function saveCurrentAnswer() {
      const answer = document.getElementById('answer-input').value;
      interviewAnswers[currentQuestionIndex] = answer;
    }

    function submitInterview() {
      saveCurrentAnswer();
      
      // Check if all questions are answered
      const unansweredCount = interviewAnswers.filter(a => !a.trim()).length;
      if (unansweredCount > 0) {
        if (!confirm(`You have ${unansweredCount} unanswered question(s). Do you want to submit anyway?`)) {
          return;
        }
      }
      
      // Show completion section
      document.getElementById('question-section').style.display = 'none';
      document.getElementById('completion-section').style.display = 'block';
      document.getElementById('progress-fill').style.width = '100%';
      
      // Generate feedback
      generateFeedback();
    }

    function generateFeedback() {
      const feedbackContent = document.getElementById('feedback-content');
      let feedbackHTML = '';
      
      interviewAnswers.forEach((answer, index) => {
        const question = interviewQuestions[index];
        const wordCount = answer.trim().split(/\s+/).length;
        let feedback = '';
        
        if (!answer.trim()) {
          feedback = '‚ùå No answer provided. Consider preparing for this type of question.';
        } else if (wordCount < 20) {
          feedback = '‚ö†Ô∏è Your answer is quite brief. Try to provide more detailed responses with specific examples.';
        } else if (wordCount < 50) {
          feedback = '‚úÖ Good start! Consider adding more specific examples and details.';
        } else {
          feedback = '‚ú® Excellent! Your answer is well-detailed and comprehensive.';
        }
        
        feedbackHTML += `
          <div class="feedback-item">
            <strong>${question.category}: ${question.question}</strong>
            <p>${feedback} (${wordCount} words)</p>
          </div>
        `;
      });
      
      feedbackContent.innerHTML = feedbackHTML;
    }

    function restartInterview() {
      document.getElementById('question-section').style.display = 'block';
      document.getElementById('completion-section').style.display = 'none';
      currentQuestionIndex = 0;
      interviewAnswers = new Array(interviewQuestions.length).fill('');
      displayQuestion();
    }

    function animateScoreRing(percent) {
      const circle = document.querySelector('.score-ring .progress');
      const scoreText = document.getElementById('score-percent');
      const radius = 50;
      const circumference = 2 * Math.PI * radius;
      circle.style.strokeDasharray = circumference;
      circle.style.strokeDashoffset = circumference;
      const scoreColor = percent < 50 ? '#ff9999' : percent < 75 ? '#ffd700' : '#b2d8b2';
      circle.style.setProperty('--score-color', scoreColor);

      let currentPercent = 0;
      const duration = 1500;
      const startTime = performance.now();

      function update() {
        const elapsed = performance.now() - startTime;
        const progress = Math.min(elapsed / duration, 1);
        currentPercent = Math.round(progress * percent);
        scoreText.textContent = `${currentPercent}%`;
        const offset = circumference - (currentPercent / 100) * circumference;
        circle.style.strokeDashoffset = offset;
        if (progress < 1) {
          requestAnimationFrame(update);
        }
      }
      requestAnimationFrame(update);
    }

    function setAnalysisData(data) {
      console.log('üìä setAnalysisData called with:', data);
      
      // Safely get score
      const percent = Math.round(data.score ?? data.scorePercent ?? 0);
      console.log('üìà Score percent:', percent);
      animateScoreRing(percent);
      
      // Display missing skills
      const skillsBox = document.getElementById('missing-skills-list');
      skillsBox.innerHTML = '';
      const missingSkills = data.missingSkills || data.missing || [];
      console.log('üéØ Missing skills:', missingSkills);
      
      if (missingSkills.length === 0) {
        const li = document.createElement('li');
        li.className = 'skill-chip';
        li.textContent = '‚úÖ All required skills matched!';
        li.style.background = 'rgba(75, 192, 75, 0.8)';
        skillsBox.appendChild(li);
      } else {
        missingSkills.forEach(skill => {
          const li = document.createElement('li');
          li.className = 'skill-chip';
          li.setAttribute('role', 'button');
          li.setAttribute('aria-label', `Learn ${skill}`);
          li.tabIndex = 0;
          li.textContent = sanitize(String(skill).trim());
          li.onclick = () => {
            console.log('üîó Navigating to learn:', skill);
            window.location.href = `learn.html?skill=${encodeURIComponent(skill)}&language=english`;
          };
          li.onkeydown = (e) => {
            if (e.key === 'Enter' || e.key === ' ') {
              e.preventDefault();
              window.location.href = `learn.html?skill=${encodeURIComponent(skill)}&language=english`;
            }
          };
          skillsBox.appendChild(li);
        });
      }
      
      // Display skill to learn first
      const skillToLearn = data.skillToLearnFirst || (missingSkills && missingSkills[0]) || 'JavaScript';
      document.getElementById('learn-first').textContent = sanitize(String(skillToLearn).trim());
      
      // Display project suggestions
      const projectsBox = document.getElementById('project-list');
      projectsBox.innerHTML = '';
      const projectSuggestions = data.projectSuggestions || [];
      console.log('üöÄ Project suggestions:', projectSuggestions);
      
      if (projectSuggestions.length === 0) {
        const li = document.createElement('li');
        li.className = 'project-card';
        li.innerHTML = `<span class="icon">üí°</span> Build real-world projects to strengthen your skills`;
        li.style.cursor = 'default';
        li.style.pointerEvents = 'none';
        projectsBox.appendChild(li);
      } else {
        projectSuggestions.forEach((proj, i) => {
          const li = document.createElement('li');
          li.className = 'project-card';
          li.setAttribute('role', 'button');
          li.setAttribute('aria-label', `View project: ${proj}`);
          li.tabIndex = 0;
          li.innerHTML = `<span class="icon">üöÄ</span> ${sanitize(String(proj).trim())}`;
          li.onclick = () => {
            console.log('üîó Navigating to project:', proj);
            window.location.href = `/dashboard/project.html?name=${encodeURIComponent(proj)}`;
          };
          li.onkeydown = (e) => {
            if (e.key === 'Enter' || e.key === ' ') {
              e.preventDefault();
              window.location.href = `/dashboard/project.html?name=${encodeURIComponent(proj)}`;
            }
          };
          projectsBox.appendChild(li);
        });
      }
      
      // Update timestamp
      const timestamp = document.getElementById('timestamp');
      if (timestamp) {
        timestamp.textContent = new Intl.DateTimeFormat(navigator.language, {
          dateStyle: 'medium',
          timeStyle: 'short'
        }).format(new Date());
      }
      
      console.log('‚úÖ Analysis data displayed successfully');
    }

    function setupMockInterview() {
      const interviewBtn = document.getElementById('start-interview-btn');
      if (interviewBtn) {
        interviewBtn.addEventListener('click', () => {
          // Get analysis data to pass to mock interview
          const data = JSON.parse(localStorage.getItem('analysisResult') || JSON.stringify(defaultData));
          localStorage.setItem('interviewData', JSON.stringify({
            missingSkills: data.missingSkills || [],
            score: data.score || 0,
            timestamp: new Date().toISOString()
          }));
          // Navigate to mock interview page
          window.location.href = 'mock-interview.html';
        });
      }
    }

    function showError(message) {
      const errorDiv = document.createElement('div');
      errorDiv.className = 'error-message';
      errorDiv.innerHTML = `
        ${message}
        <button aria-label="Dismiss error">√ó</button>
      `;
      document.body.appendChild(errorDiv);
      errorDiv.querySelector('button').addEventListener('click', () => errorDiv.remove());
      setTimeout(() => errorDiv.remove(), 5000);
    }

    function exportAnalysis() {
      const data = JSON.parse(localStorage.getItem('analysisResult') || JSON.stringify(defaultData));
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'resume-analysis.json';
      a.click();
      URL.revokeObjectURL(url);
    }

    window.addEventListener('DOMContentLoaded', function() {
      console.log('üîç Loading analysis results...');
      
      let data = null;
      try {
        const stored = localStorage.getItem('analysisResult');
        console.log('üì¶ Stored analysis result:', stored);
        
        if (!stored) {
          console.warn('‚ö†Ô∏è No analysis result found in localStorage, using default data');
          data = defaultData;
        } else {
          data = JSON.parse(stored);
          console.log('‚úÖ Parsed data:', data);
          
          // Validate and transform the data structure
          if (!validateData(data)) {
            console.warn('‚ö†Ô∏è Invalid data format, using defaults');
            data = defaultData;
          }
          
          // If data has the backend response format, transform it
          if (data.score !== undefined && (data.missing || data.matched)) {
            console.log('üîÑ Transforming backend response format...');
            data = {
              score: data.score || 0,
              missingSkills: data.missing || [],
              matchedSkills: data.matched || [],
              projectSuggestions: generateProjectSuggestions(data),
              skillToLearnFirst: (data.missing && data.missing[0]) || 'JavaScript'
            };
            console.log('‚úÖ Transformed data:', data);
          }
        }
      } catch (error) {
        console.error('‚ùå Error parsing analysis result:', error);
        data = defaultData;
      }
      
      console.log('üìä Final data to display:', data);
      setAnalysisData(data);
      setupMockInterview();
      
      const startLearningBtn = document.getElementById('start-learning-btn');
      if (startLearningBtn) {
        startLearningBtn.addEventListener('click', () => {
          const skill = document.getElementById('learn-first').textContent.trim();
          if (skill && window.navigateToLearn) {
            window.navigateToLearn(skill, 'analysis');
          } else {
            console.log('Using fallback navigation method');
            localStorage.setItem('selectedSkill', skill);
            window.location.href = `/dashboard/learn.html?skill=${encodeURIComponent(skill)}`;
          }
        });
      }
      const skillElements = document.querySelectorAll('.skill-chip');
      skillElements.forEach(skillEl => {
        skillEl.addEventListener('click', () => {
          const skill = skillEl.textContent.trim();
          if (window.navigateToLearn) {
            window.navigateToLearn(skill, 'analysis');
          } else {
            localStorage.setItem('selectedSkill', skill);
            window.location.href = `/dashboard/learn.html?skill=${encodeURIComponent(skill)}`;
          }
        });
      });
    });
    
    // Helper function to generate project suggestions based on skills
    function generateProjectSuggestions(data) {
      const domain = data.domain || 'general';
      const projectMap = {
        'it': [
          'Build a Web Application with React & Node.js',
          'Create a REST API with Python Flask',
          'Deploy a Machine Learning Model',
          'Build a Real-time Chat Application',
          'Create a Mobile App with React Native'
        ],
        'data': [
          'Build a Data Analysis Dashboard',
          'Create a Predictive ML Model',
          'Analyze Large Datasets with Python',
          'Build a Data Visualization Project',
          'Create an ETL Pipeline'
        ],
        'default': [
          'Build a Full-Stack Web Application',
          'Create a Portfolio Project',
          'Contribute to Open Source',
          'Build a CLI Tool',
          'Create a Database Project'
        ]
      };
      
      const projects = projectMap[domain] || projectMap['default'];
      return projects.slice(0, 3);
    }
  </script>
</body>
</html>
