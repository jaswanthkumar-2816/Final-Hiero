<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resume Builder Complete Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .test-container { max-width: 1200px; margin: 0 auto; }
        .test-section { 
            background: white; 
            padding: 20px; 
            margin: 20px 0; 
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .test-btn {
            background: #0066cc;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
        }
        .test-btn:hover { background: #004499; }
        .test-btn.success { background: #28a745; }
        .test-btn.danger { background: #dc3545; }
        .debug-info {
            background: #e8f4f8;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: monospace;
            font-size: 14px;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        .status { font-weight: bold; padding: 5px 10px; border-radius: 4px; margin: 5px 0; }
        .status.pass { background: #d4edda; color: #155724; }
        .status.fail { background: #f8d7da; color: #721c24; }
        iframe { width: 100%; height: 600px; border: 2px solid #ddd; border-radius: 8px; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>Resume Builder Complete Test Suite</h1>
        
        <div class="test-section">
            <h2>Test Instructions</h2>
            <p>This test will verify the skip functionality in the resume builder:</p>
            <ol>
                <li>First, load the resume builder below</li>
                <li>Select any template and click "Start Building"</li>
                <li>Once the form is visible, test the skip links</li>
                <li>Each section should have a "Skip this section" link</li>
                <li>Clicking it should dim the section and hide its content</li>
                <li>The link text should change to "Show section"</li>
            </ol>
        </div>

        <div class="test-section">
            <h2>Test Controls</h2>
            <button class="test-btn" onclick="loadResumeBuilder()">Load Resume Builder</button>
            <button class="test-btn" onclick="runAutomatedTests()">Run Automated Tests</button>
            <button class="test-btn" onclick="clearLog()">Clear Log</button>
            
            <div id="testResults"></div>
            
            <div class="debug-info" id="testLog">
Test log will appear here...
            </div>
        </div>

        <div class="test-section">
            <h2>Resume Builder</h2>
            <iframe id="resumeFrame" src="about:blank"></iframe>
        </div>
    </div>

    <script>
        function log(message, type = 'info') {
            const logEl = document.getElementById('testLog');
            const timestamp = new Date().toLocaleTimeString();
            const prefix = type === 'error' ? '❌' : type === 'success' ? '✅' : 'ℹ️';
            logEl.textContent += `[${timestamp}] ${prefix} ${message}\n`;
            logEl.scrollTop = logEl.scrollHeight;
        }

        function clearLog() {
            document.getElementById('testLog').textContent = 'Test log cleared...\n';
            document.getElementById('testResults').innerHTML = '';
        }

        function loadResumeBuilder() {
            log('Loading resume builder...');
            const frame = document.getElementById('resumeFrame');
            frame.src = 'http://localhost:8082/resume-builder.html';
            
            frame.onload = function() {
                log('Resume builder loaded successfully', 'success');
                setTimeout(() => {
                    checkFrameContent();
                }, 1000);
            };
            
            frame.onerror = function() {
                log('Failed to load resume builder', 'error');
            };
        }

        function checkFrameContent() {
            try {
                const frame = document.getElementById('resumeFrame');
                const frameDoc = frame.contentDocument || frame.contentWindow.document;
                
                if (frameDoc) {
                    log('Frame content is accessible', 'success');
                    
                    // Check for template selection
                    const templateSelection = frameDoc.getElementById('templateSelection');
                    if (templateSelection) {
                        log('Template selection found', 'success');
                        
                        // Check if form is hidden
                        const mainLayout = frameDoc.querySelector('.main-layout');
                        if (mainLayout) {
                            const isHidden = mainLayout.style.display === 'none' || 
                                           window.getComputedStyle(mainLayout).display === 'none';
                            log(`Form is ${isHidden ? 'hidden' : 'visible'} (expected: hidden)`, 
                                isHidden ? 'success' : 'error');
                        }
                        
                        // Look for template cards
                        const templateCards = frameDoc.querySelectorAll('.template-card');
                        log(`Found ${templateCards.length} template cards`);
                        
                        if (templateCards.length > 0) {
                            log('You can now select a template to test skip functionality', 'success');
                        }
                    } else {
                        log('Template selection not found', 'error');
                    }
                } else {
                    log('Cannot access frame content (CORS restriction)', 'error');
                }
            } catch (error) {
                log(`Error checking frame content: ${error.message}`, 'error');
            }
        }

        function runAutomatedTests() {
            log('Running automated tests...');
            
            // Test 1: Check if the basic HTML structure exists
            testBasicStructure();
            
            // Test 2: Check CSS classes
            testCSSClasses();
            
            // Test 3: Test localStorage functionality
            testLocalStorage();
            
            log('Automated tests complete. For full testing, manually select a template in the resume builder above.');
        }

        function testBasicStructure() {
            log('Testing basic structure...');
            
            fetch('http://localhost:8082/resume-builder.html')
                .then(response => response.text())
                .then(html => {
                    // Check for skip links
                    const skipLinkCount = (html.match(/skip-link/g) || []).length;
                    log(`Found ${skipLinkCount} skip-link references`);
                    
                    // Check for toggleSection function
                    const hasToggleFunction = html.includes('function toggleSection');
                    log(`toggleSection function exists: ${hasToggleFunction}`, 
                        hasToggleFunction ? 'success' : 'error');
                    
                    // Check for form sections
                    const sectionCount = (html.match(/section-/g) || []).length;
                    log(`Found ${sectionCount} section references`);
                    
                    // Check for skipped CSS class
                    const hasSkippedCSS = html.includes('.form-section.skipped');
                    log(`Skipped CSS class exists: ${hasSkippedCSS}`, 
                        hasSkippedCSS ? 'success' : 'error');
                    
                    displayTestResults('Basic Structure', [
                        { test: 'Skip links found', pass: skipLinkCount > 0, details: `Found ${skipLinkCount}` },
                        { test: 'toggleSection function', pass: hasToggleFunction, details: hasToggleFunction ? 'Found' : 'Missing' },
                        { test: 'Form sections', pass: sectionCount > 0, details: `Found ${sectionCount}` },
                        { test: 'Skipped CSS class', pass: hasSkippedCSS, details: hasSkippedCSS ? 'Found' : 'Missing' }
                    ]);
                })
                .catch(error => {
                    log(`Error fetching resume builder: ${error.message}`, 'error');
                });
        }

        function testCSSClasses() {
            log('Testing CSS classes...');
            
            // Create test elements to verify CSS behavior
            const testContainer = document.createElement('div');
            testContainer.innerHTML = `
                <style>
                    .test-form-section { transition: all 0.4s ease; }
                    .test-form-section.skipped { opacity: 0.4; pointer-events: none; }
                </style>
                <div class="test-form-section" id="testSection">
                    <div class="form-content">Test content</div>
                </div>
            `;
            
            document.body.appendChild(testContainer);
            
            const testSection = document.getElementById('testSection');
            
            // Test toggle functionality
            const wasSkipped = testSection.classList.contains('skipped');
            testSection.classList.toggle('skipped');
            const isSkipped = testSection.classList.contains('skipped');
            
            log(`CSS toggle test: ${wasSkipped} -> ${isSkipped}`, 'success');
            
            // Clean up
            document.body.removeChild(testContainer);
            
            displayTestResults('CSS Classes', [
                { test: 'CSS toggle works', pass: wasSkipped !== isSkipped, details: `${wasSkipped} -> ${isSkipped}` }
            ]);
        }

        function testLocalStorage() {
            log('Testing localStorage...');
            
            try {
                // Test localStorage functionality
                const testKey = 'test_skip_section_summary';
                localStorage.setItem(testKey, 'true');
                const retrieved = localStorage.getItem(testKey);
                const works = retrieved === 'true';
                
                // Clean up
                localStorage.removeItem(testKey);
                
                log(`localStorage test: ${works}`, works ? 'success' : 'error');
                
                displayTestResults('localStorage', [
                    { test: 'localStorage works', pass: works, details: works ? 'Working' : 'Failed' }
                ]);
                
            } catch (error) {
                log(`localStorage error: ${error.message}`, 'error');
                
                displayTestResults('localStorage', [
                    { test: 'localStorage works', pass: false, details: error.message }
                ]);
            }
        }

        function displayTestResults(category, tests) {
            const resultsEl = document.getElementById('testResults');
            
            const categoryDiv = document.createElement('div');
            categoryDiv.innerHTML = `<h3>${category}</h3>`;
            
            tests.forEach(test => {
                const statusDiv = document.createElement('div');
                statusDiv.className = `status ${test.pass ? 'pass' : 'fail'}`;
                statusDiv.textContent = `${test.test}: ${test.pass ? 'PASS' : 'FAIL'} (${test.details})`;
                categoryDiv.appendChild(statusDiv);
            });
            
            resultsEl.appendChild(categoryDiv);
        }

        // Initial log
        log('Resume Builder Test Suite loaded');
        log('Click "Load Resume Builder" to begin testing');
    </script>
</body>
</html>
