<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Solve Problem - Hiero</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;700&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --soft-teal: #030e04;
      --lavender: #011104;
      --warm-beige: #09c006;
      --soft-green: #08c108;
      --gold-accent: #169f04;
      --bg-light: #060706;
      --card-bg: rgb(3, 3, 3);
      --text-dark: #333333;
      --shadow-glow: 0 0 15px rgb(17, 173, 17), 0 0 10px rgba(212, 160, 23, 0.3);
      --border-radius: 15px;
      --padding: 20px;
    }

    body {
      margin: 0;
      padding: 0;
      background: linear-gradient(135deg, var(--soft-teal) 0%, var(--lavender) 50%, var(--warm-beige) 100%);
      font-family: 'Open Sans', sans-serif;
      color: var(--text-dark);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      overflow-x: hidden;
      position: relative;
      animation: gradientFlow 20s ease infinite;
    }

    @keyframes gradientFlow {
      0% { background-position: 0% 0%; }
      50% { background-position: 50% 50%; }
      100% { background-position: 0% 0%; }
    }

    .logo-fixed {
      position: absolute;
      top: 25px;
      right: 32px;
      display: flex;
      align-items: center;
      z-index: 100;
      background: rgba(8, 164, 8, 0.805);
      border-radius: 12px;
      padding: 6px 16px 6px 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.959), var(--shadow-glow);
    }

    .logo-fixed img {
      height: 38px;
      width: 38px;
      min-width: 38px;
      min-height: 38px;
      object-fit: contain;
      filter: drop-shadow(var(--shadow-glow));
    }

    .logo-fixed span {
      font-weight: 700;
      letter-spacing: 1.5px;
      font-size: 1.2rem;
      margin-left: 6px;
      color: white;
    }

    .back-btn {
      position: absolute;
      top: 25px;
      left: 32px;
      background: rgba(8, 164, 8, 0.805);
      color: white;
      border: none;
      border-radius: 12px;
      padding: 10px 20px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.959), var(--shadow-glow);
      transition: all 0.3s ease;
      z-index: 100;
    }

    .back-btn:hover {
      background: rgba(8, 164, 8, 1);
      transform: translateY(-2px);
    }

    .main-container {
      max-width: 1200px;
      width: 100%;
      margin: 80px auto 20px;
      padding: 0 20px;
      display: flex;
      flex-direction: column;
      gap: 30px;
    }

    .problem-card {
      background: var(--card-bg);
      border-radius: var(--border-radius);
      padding: var(--padding);
      box-shadow: var(--shadow-glow);
      color: white;
      animation: slideUp 0.8s ease-out;
    }

    @keyframes slideUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .problem-header {
      border-bottom: 2px solid var(--gold-accent);
      padding-bottom: 15px;
      margin-bottom: 20px;
    }

    .problem-title {
      font-family: 'Lora', serif;
      font-size: 2rem;
      color: var(--gold-accent);
      margin: 0 0 10px 0;
    }

    .problem-difficulty {
      display: inline-block;
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 0.9rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .easy { background: #4CAF50; color: white; }
    .medium { background: #FF9800; color: white; }
    .hard { background: #F44336; color: white; }

    .problem-description {
      font-size: 1.1rem;
      line-height: 1.6;
      margin-bottom: 20px;
      color: #e0e0e0;
    }

    .solution-area {
      background: #1a1a1a;
      border-radius: var(--border-radius);
      padding: var(--padding);
      margin: 20px 0;
    }

    .solution-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .solution-title {
      font-size: 1.3rem;
      color: var(--gold-accent);
      margin: 0;
    }

    .language-selector {
      background: var(--soft-green);
      color: white;
      border: none;
      border-radius: 8px;
      padding: 8px 15px;
      font-size: 0.9rem;
      cursor: pointer;
      transition: background 0.3s ease;
    }

    .language-selector:hover {
      background: var(--gold-accent);
    }

    .code-editor {
      width: 100%;
      min-height: 300px;
      background: #0f0f0f;
      color: #f8f8f2;
      border: 2px solid #333;
      border-radius: 8px;
      padding: 15px;
      font-family: 'Courier New', monospace;
      font-size: 14px;
      line-height: 1.4;
      resize: vertical;
      outline: none;
      transition: border-color 0.3s ease;
    }

    .code-editor:focus {
      border-color: var(--gold-accent);
    }

    .action-buttons {
      display: flex;
      gap: 15px;
      margin-top: 20px;
      flex-wrap: wrap;
    }

    .action-btn {
      background: var(--soft-green);
      color: white;
      border: none;
      border-radius: 8px;
      padding: 12px 24px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
    }

    .action-btn:hover {
      background: var(--gold-accent);
      transform: translateY(-2px);
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4);
    }

    .action-btn.secondary {
      background: #666;
    }

    .action-btn.secondary:hover {
      background: #888;
    }

    .hint-area {
      background: rgba(255, 193, 7, 0.1);
      border: 1px solid #ffc107;
      border-radius: 8px;
      padding: 15px;
      margin-top: 20px;
      display: none;
    }

    .hint-title {
      color: #ffc107;
      font-weight: 600;
      margin-bottom: 10px;
    }

    .hint-text {
      color: #e0e0e0;
      line-height: 1.5;
    }

    .output-area {
      background: #0f0f0f;
      border: 2px solid #333;
      border-radius: 8px;
      padding: 15px;
      margin-top: 20px;
      min-height: 100px;
      font-family: 'Courier New', monospace;
      color: #f8f8f2;
      white-space: pre-wrap;
      display: none;
    }

    .output-title {
      color: var(--gold-accent);
      font-weight: 600;
      margin-bottom: 10px;
      font-family: 'Open Sans', sans-serif;
    }

    @media (max-width: 768px) {
      .main-container {
        margin: 60px auto 20px;
        padding: 0 15px;
      }
      
      .problem-title {
        font-size: 1.5rem;
      }
      
      .action-buttons {
        flex-direction: column;
      }
      
      .action-btn {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="logo-fixed">
    <img src="logohiero copy.png" alt="Logo">
    <span>HIERO</span>
  </div>

  <button class="back-btn" onclick="goBack()" aria-label="Back to learning">üîô Back</button>

  <div class="main-container">
    <div class="problem-card">
      <div class="problem-header">
        <h1 class="problem-title" id="problem-title">Loading Problem...</h1>
        <span class="problem-difficulty" id="problem-difficulty">Unknown</span>
      </div>
      
      <div class="problem-description" id="problem-description">
        Loading problem description...
      </div>

      <div class="solution-area">
        <div class="solution-header">
          <h3 class="solution-title">Your Solution</h3>
          <select class="language-selector" id="language-selector">
            <option value="python">Python</option>
            <option value="javascript">JavaScript</option>
            <option value="java">Java</option>
            <option value="cpp">C++</option>
            <option value="c">C</option>
          </select>
        </div>
        
        <textarea 
          class="code-editor" 
          id="code-editor" 
          placeholder="// Write your solution here..."
          spellcheck="false"
        ></textarea>
        
        <div class="action-buttons">
          <button class="action-btn" onclick="runCode()" id="run-btn">
            üöÄ Run Code
          </button>
          <button class="action-btn secondary" onclick="showHint()" id="hint-btn">
            üí° Show Hint
          </button>
          <button class="action-btn secondary" onclick="resetCode()">
            üîÑ Reset
          </button>
          <button class="action-btn secondary" onclick="saveProgress()">
            üíæ Save Progress
          </button>
        </div>
        
        <div class="hint-area" id="hint-area">
          <div class="hint-title">üí° Hint</div>
          <div class="hint-text" id="hint-text">
            No hint available for this problem.
          </div>
        </div>
        
        <div class="output-area" id="output-area">
          <div class="output-title">Output:</div>
          <div id="output-content"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Function to sanitize text content
    function sanitize(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // Function to go back to the previous page
    function goBack() {
      // Try to go back in history, or default to learn.html
      if (document.referrer && document.referrer.includes('learn.html')) {
        window.history.back();
      } else {
        window.location.href = 'learn.html';
      }
    }

    // Function to get URL parameters
    function getUrlParams() {
      const params = new URLSearchParams(window.location.search);
      return {
        title: params.get('title') || 'Unknown Problem',
        description: params.get('description') || 'No description available.',
        hint: params.get('hint') || 'No hint available.',
        difficulty: params.get('difficulty') || 'unknown'
      };
    }

    // Function to get problem data from localStorage
    function getProblemFromStorage() {
      try {
        const problemData = localStorage.getItem('currentProblem');
        if (problemData) {
          const parsed = JSON.parse(problemData);
          // Clear after reading to avoid stale data
          localStorage.removeItem('currentProblem');
          return parsed;
        }
      } catch (error) {
        console.error('Error reading problem from localStorage:', error);
      }
      return null;
    }

    // Function to initialize the page with problem data
    function initializePage() {
      // Try localStorage first, then URL params
      let problemData = getProblemFromStorage();
      if (!problemData || !problemData.title) {
        problemData = getUrlParams();
      }

      // Set problem details
      document.getElementById('problem-title').textContent = problemData.title;
      document.getElementById('problem-description').textContent = problemData.description;
      document.getElementById('hint-text').textContent = problemData.hint;
      
      // Set difficulty badge
      const difficultyElement = document.getElementById('problem-difficulty');
      difficultyElement.textContent = problemData.difficulty.toUpperCase();
      difficultyElement.className = `problem-difficulty ${problemData.difficulty.toLowerCase()}`;

      // Set up language-specific code templates
      setupCodeTemplates();
      
      // Load saved progress if any
      loadSavedProgress();
    }

    // Function to set up code templates for different languages
    function setupCodeTemplates() {
      const templates = {
        python: `def solution():
    # Write your solution here
    pass

# Test your solution
if __name__ == "__main__":
    result = solution()
    print(result)`,
        javascript: `function solution() {
    // Write your solution here
    return null;
}

// Test your solution
console.log(solution());`,
        java: `public class Solution {
    public static void main(String[] args) {
        Solution sol = new Solution();
        // Test your solution
        System.out.println(sol.solve());
    }
    
    public Object solve() {
        // Write your solution here
        return null;
    }
}`,
        cpp: `#include <iostream>
using namespace std;

class Solution {
public:
    // Write your solution here
    void solve() {
        
    }
};

int main() {
    Solution sol;
    sol.solve();
    return 0;
}`,
        c: `#include <stdio.h>

// Write your solution here
void solve() {
    
}

int main() {
    solve();
    return 0;
}`
      };

      const languageSelector = document.getElementById('language-selector');
      const codeEditor = document.getElementById('code-editor');

      languageSelector.addEventListener('change', function() {
        const selectedLanguage = this.value;
        codeEditor.value = templates[selectedLanguage] || '';
        codeEditor.placeholder = `// Write your ${selectedLanguage} solution here...`;
      });

      // Set initial template
      codeEditor.value = templates.python;
    }

    // Function to show hint
    function showHint() {
      const hintArea = document.getElementById('hint-area');
      const hintBtn = document.getElementById('hint-btn');
      
      if (hintArea.style.display === 'none' || !hintArea.style.display) {
        hintArea.style.display = 'block';
        hintBtn.textContent = 'üôà Hide Hint';
      } else {
        hintArea.style.display = 'none';
        hintBtn.textContent = 'üí° Show Hint';
      }
    }

    // Function to simulate code execution
    function runCode() {
      const codeEditor = document.getElementById('code-editor');
      const outputArea = document.getElementById('output-area');
      const outputContent = document.getElementById('output-content');
      const runBtn = document.getElementById('run-btn');
      const languageSelector = document.getElementById('language-selector');
      
      const code = codeEditor.value.trim();
      const language = languageSelector.value;
      
      if (!code) {
        alert('Please write some code before running!');
        return;
      }

      // Show loading state
      runBtn.textContent = '‚è≥ Running...';
      runBtn.disabled = true;
      
      // Judge0 API settings (replace with your own endpoint and API key)
      const apiUrl = 'https://api.judge0.com/submissions';
      const apiKey = 'YOUR_API_KEY';  // <-- Replace this with your actual API key

      // Prepare data for Judge0 API
      const requestData = {
        source_code: code,
        language_id: getLanguageId(language),
        stdin: '',
        expected_output: '',
        cpu_time_limit: 2,
        wall_time_limit: 5,
        memory_limit: 128,
        output_limit: 4096,
        test_run: false
      };

      // Send code to Judge0 API for execution
      fetch(apiUrl, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-Judge0-Api-Key': apiKey
        },
        body: JSON.stringify(requestData)
      })
      .then(response => response.json())
      .then(data => {
        // Handle Judge0 API response
        if (data.token) {
          // Code submitted successfully, now fetch the result
          fetch(`${apiUrl}/${data.token}`)
            .then(res => res.json())
            .then(result => {
              // Display output or error message
              if (result.stdout) {
                outputContent.textContent = `Output:\n${atob(result.stdout)}`;
              } else if (result.stderr) {
                outputContent.textContent = `Error:\n${atob(result.stderr)}`;
              } else {
                outputContent.textContent = 'No output or error message received.';
              }
              outputArea.style.display = 'block';
            })
            .catch(err => {
              console.error('Error fetching result from Judge0:', err);
              outputContent.textContent = 'Error fetching result. Please try again.';
              outputArea.style.display = 'block';
            });
        } else {
          console.error('Error submitting code to Judge0:', data);
          outputContent.textContent = 'Error submitting code. Please try again.';
          outputArea.style.display = 'block';
        }
      })
      .catch(err => {
        console.error('Network error:', err);
        outputContent.textContent = 'Network error. Please check your connection and try again.';
        outputArea.style.display = 'block';
      })
      .finally(() => {
        // Reset button state
        runBtn.textContent = 'üöÄ Run Code';
        runBtn.disabled = false;
      });
    }

    // Function to reset code to template
    function resetCode() {
      if (confirm('Are you sure you want to reset your code? This will clear all your work.')) {
        const languageSelector = document.getElementById('language-selector');
        const event = new Event('change');
        languageSelector.dispatchEvent(event);
      }
    }

    // Function to save progress
    function saveProgress() {
      const problemTitle = document.getElementById('problem-title').textContent;
      const language = document.getElementById('language-selector').value;
      const code = document.getElementById('code-editor').value;
      
      const progressKey = `problem_${problemTitle.replace(/\s+/g, '_')}_${language}`;
      
      try {
        localStorage.setItem(progressKey, code);
        
        // Show temporary success message
        const saveBtn = event.target;
        const originalText = saveBtn.textContent;
        saveBtn.textContent = '‚úÖ Saved!';
        saveBtn.style.background = '#4CAF50';
        
        setTimeout(() => {
          saveBtn.textContent = originalText;
          saveBtn.style.background = '';
        }, 2000);
        
      } catch (error) {
        console.error('Error saving progress:', error);
        alert('Error saving progress. Please try again.');
      }
    }

    // Function to load saved progress
    function loadSavedProgress() {
      const problemTitle = document.getElementById('problem-title').textContent;
      const languageSelector = document.getElementById('language-selector');
      const codeEditor = document.getElementById('code-editor');
      
      languageSelector.addEventListener('change', function() {
        const language = this.value;
        const progressKey = `problem_${problemTitle.replace(/\s+/g, '_')}_${language}`;
        
        try {
          const savedCode = localStorage.getItem(progressKey);
          if (savedCode) {
            codeEditor.value = savedCode;
          }
        } catch (error) {
          console.error('Error loading saved progress:', error);
        }
      });
    }

    // Initialize page when DOM is loaded
    document.addEventListener('DOMContentLoaded', initializePage);
  </script>
</body>
</html>
